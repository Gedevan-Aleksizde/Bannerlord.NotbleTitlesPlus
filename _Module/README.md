
Noble Titles Plus - Noble Titles and Styles Customization

日本語の説明は英語の後にあります

# What's this?

This is a remake of Zijistark's [Noble Titles](https://www.nexusmods.com/mountandblade2bannerlord/mods/2089) for the Bannerlord >= v1.1.x. This mod has some extra features. If you don't know the original mod, please check it first.

# New Features

Compared with the original, this mod added the following features.

## Customization and Presets by MCM

You can edit the titles by using Mod Configuration Menu (MCM). I also provided my new title preset. You can also edit the settings by JSON file in the MCM folder (usually at `Mount and Blade II Bannerlord\Configs\ModSettings` in the My Document folder)

Note: Pressing the "e" key transits the other tab. But I can't fix this because it's an MCM issue.

Note for those have installed the older versions: the former titles.json is unavailable until v2.0.x. You need to edit the titles manually if you created your titles. Sorry for the inconvenience!


## Flexible Placeholders

I introduced a new placeholder "{NAME}" and "{CLAN}" to enable more complex noble titles and styles. E.g.:

* "Imperator Caesar {NAME} {CLAN}" -> "Imperator Caesar Galios Comnos"
* "{NAME}, King of Vlandia" -> "Derthert, King of Vlandia"
* "{NAME} Khan" -> "Monchug Khan"
* "Grand Prince {NAME} \"The Terrible\"" -> 'Grand Prince Raganvad "The Terrible"' (NOTE: You need to prefix a backtick to use a double quotation inside the title)

The default titles are as same as the vanilla. I also prepare the original preset (by Zijistark) and my title set. Please see the images.

Current supporting placeholders:

* {NAME}
* {CLAN} and {CLAN_SHORT}
* {FIEFS}

## Titles for More Heroes

You can set the titles for the clan members and minor faction heroes.

You can also set the heir apparent (Crown Prince/Princess)s' titles and the law of settlement of the succession. However, please note that the heir apparent doesn't always inherit the throne because of the Bannerlord's vanilla rule.

## Faction-Specific Titles

You can edit the title set for each faction, as well as each culture. E.g., The Northern, Western, and Southern Empires are in the same culture: the Empire. So, they share the Empire culture's titles and they can override other titles if you fill in any faction-specific inputs to display _Augustus Lucon_, _Imperator Caesar Galios_, and _Sebaste Basileia Raghaea_. The faction-specific titles are ignored if it is blank.

## Fog of War

This mod is adopted with the fog of war concept that is introduced since Bannerlord v1.1.0. Any unseen NPC's title is hidden unless his/her spouse is already known as default. You can change this setting by MCM.

# How to Install

As usual.

1. you can manually download and move the folder to the Modules folder or by Vortex (But I prefer Mod Organizer 2).
2. Install [MCM](https://www.nexusmods.com/mountandblade2bannerlord/mods/612)

NOTE: Please don't forget to install MCM dependencies: [Harmony](https://www.nexusmods.com/mountandblade2bannerlord/mods/2006), [ButterLib](https://www.nexusmods.com/mountandblade2bannerlord/mods/2018), [UIExtenderEx](https://www.nexusmods.com/mountandblade2bannerlord/mods/2102) (and [Better Exception Window](https://www.nexusmods.com/mountandblade2bannerlord/mods/404)). Although MCM is a soft dependency so the essential dependency is only Harmony, however, I strongly recommend installing MCM.

# How to Uninstall

Just delete the folder. Both deactivating and deleting this mod don't affect your saved data.

# Notes 

* This mod is NOT compatible with [Always Show Titles](https://www.nexusmods.com/mountandblade2bannerlord/mods/5178)
* If you don't like the lore dumping, set the same titles just "{NAME}" or set the same titles.

# Known Issues

* Pressing the "e" key transits the other tab. But I can't fix this because it's an MCM issue.
 
# If You Encounted a Bug

Please check the log files in "My Document\Mount and Blade II Bannerlord\Logs" first. You can find the sentences like [WARNING] blah blah... if the mod encounters some errors.

If the game crashes frequently, please check the log first too. In case you can't find any clue from the log, disable or uninstall any extra mods (except with Harmony, ButterLib, UIExtenderEx, MCM, Better Exception Window, and 2 official mods) and play the game again. if the problem continues, show me the report generated by the [Better Exception Window](https://www.nexusmods.com/mountandblade2bannerlord/mods/404). It's helpful for me to upload your crash report and just paste its URL here. (I don't recommend submitting a report only by [ButterLib](https://www.nexusmods.com/mountandblade2bannerlord/mods/2018) because it can't show which mod is loaded.) Otherwise, the crash is caused by a conflict with the other mods. You can submit the report with extra mods enabled and write that you suspect the bug is caused by the other mods if you want to do. I welcome such a report that mod(s) conflicts with my mod, however, I can't always solve the conflict. Generally speaking, making a mod compatible with all the other mods is almost impossible. 

I won't respond to any other less-informative bug reporting. False reporting and trolling can lead to being blocked.

Hint: you decrease the enabled mods as far as possible, I can find the cause of the bug easier.


# Old Documents (v1.x)

The following statements are about older versions (v1.x)

* DON'T USE the titles.json from the original mod (also Noble Titles 1.0). It can't work correctly.

## How to Update

1. Back up your titles.json
2. Delete the current `NObleTItlesPlus` folder
3. Copy the new folder

## Customization

Please read the original page first.

## How to change the titles

You can change the titles by editing titles.json in this module folder. However, please be careful that this mod introduces a new syntax. Hence you can't use the old JSON used by Noble Titles and Noble Titles 1.0.

## How to Apply to Extra Cultures

You can define different titles for each new custom Culture provided by some mods (e.g., Huaxia Kingdom).

Copy one of any faction's title sets and rename its name to the custom faction's ID which can be found in <Culture id="..."> tag from one of its XML files. E.g., if you want to define the noble hierarchy of the Huaxia Kingdom, write its Culture ID "huaxia" (in the case of v2.2.0)



----------------------------------------

# Modの解説

Noble Titles のリメイク版です. 基本的にはオリジナルのNoble Titleと同じですが, 柔軟性のため本家のものに対し少し機能を追加しています. また, より安全な実装を求めてコードを大幅に変更したので, 仕様が細部で異なります.

このmodは常に各国の貴族たちの名前に称号を付けます. バニラでは君主と領主(クランリーダー)に称号がありますが, 表示される場所は限られています. このmodはゲーム中のほとんど箇所で称号を表示します. 加えて領主は勢力内部での権勢の序列に応じて称号が変化します. 君主と領主以外の貴族にも称号を付けます. これらの称号は, 所属勢力と性別ごとに自由に設定できます.


# 新機能

Zijistark のオリジナルにはない機能を紹介します.

## MCM 対応

全ての設定を Mod Configuration Menu (MCM) で管理できます. Zijistark のオリジナルの称号と, 私が独自に考えた称号のプリセットも用意されています. 詳細は画像を見てください.

注: ただしMCMは現状文字入力の挙動がおかしいです (というかMB2本体がおかしい?). 入力しづらい場合はJSONファイルを直接編集することもできます. たいていはマイドキュメントの `Mount and Blade II Bannerlord\Configs\ModSettings` フォルダ以下のどこかにあります.

古いバージョン(v1.x)を使っていた人へ: settings.json はMCMへ移行したため読み込まれなくなりました. 自分で独自の設定を作っていた場合, お手数ですが自力で入力し直してください.

## 柔軟な変数機能

接頭語・接尾語・その他条件によって名称を変化させるため, 以下のような特殊な文字列は変数として扱われ, 表示の際に置き換えられます.

* `{NAME}` -> そのNPCの名前に置き換えられます.
* `{CLAN}` または `{CLAN_SHORT}` -> そのNPCの所属クラン名です. 小規模勢力の場合は名前が長いため `{NAME_SHORT}` で略称に置き換えることをお薦めします.
* `{FIEFS}` -> そのNPCの所属クランの所持している領地名です. 「---の領主」などと表示したい場合にお使いください.

## 対象NPCの範囲拡大

* 小規模勢力のNPCにも称号を設定できます
* 領主 (クランリーダー) だけでなくクランの一般貴族の称号も設定できます
* 王太子/女の称号も設定できます. ただしBannerlordの仕様上, 王太子が実際に後継者になるとは限りません.

## 派閥ごとの称号

オリジナルは称号を文化単位でしか設定できませんでした. 例えば北・西・南帝国の各派閥は全て「帝国」文化なので, 全て称号が同じです. 一方でこのmodは派閥単位で設定できます. つまり, ルーコン・ガリオス・ラガエアそれぞれに異なった称号を名乗らせることもできます. 派閥単位の称号は対応する欄に何か入力された場合のみ適用され, 空白の場合は無視され所属文化の称号が使用されます.

## 戦場の霧

本体 v1.1.0 以降追加された戦場の霧に対応するように, 称号も会うまで表示されないようにしました.

# インストール方法

いつも通りです.

1. 通常通りダウンロードしてモジュールフォルダに配置してください. Mod Organizer 2 とかを使うと楽です.
2. [MCM](https://www.nexusmods.com/mountandblade2bannerlord/mods/612) も忘れずにインストールしてください.

注: MCMが依存しているmodのインストールも忘れないでください. つまり, [Harmony](https://www.nexusmods.com/mountandblade2bannerlord/mods/2006), [ButterLib](https://www.nexusmods.com/mountandblade2bannerlord/mods/2018), [UIExtenderEx](https://www.nexusmods.com/mountandblade2bannerlord/mods/2102) (そしてできれば [Better Exception Window](https://www.nexusmods.com/mountandblade2bannerlord/mods/404)) のことです. MCM は soft dependency なのでインストールしなくても動作するため, 本当に最低限必要なのは Harmony だけですが, 利便性のためこれらもインストールすることを強く推奨します.


# アンインストール方法

* フォルダを削除するだけでアンインストールできます. キャンペーンモードの途中で消してもセーブデータに影響を与えません


# 互換性

ほとんどのmodと互換性がありますが, 名前を変更するタイプのmodと併用すると問題が発生することがあります. Always Show Titles や  Detailed Character Creation などです. 前者はゲーム本来の称号だけ表示するため, いくつもの称号が要らないというのであればこのmodではなく [Always Show Titles](https://www.nexusmods.com/mountandblade2bannerlord/mods/5178) を使ったほうがいいと思います.


# 爵位の判定に関する細かい定義

爵位はfief score という独自のスコアで序列づけして決定されます.

1. Nobles: いずれかの勢力に属しているクランのNPCで, かつリーダー・君主でない
2. Baron: いずれかの勢力に所属するクランリーダーで, スコアが3未満
3. Count: いずれかの勢力に所属するクランリーダーで, スコアが下位3分の2で, かつBaronの条件を満たさない
4. Duke: いずれかの勢力に所属するクランリーダーで, スコアが上位3分の1で, かつCountの条件を満たさない
5. King: 各国・勢力の君主のみ
6. Prince (王太子/女): 各勢力の君主と同じクランに所属し, 君主とその配偶者以外の最大で誰か1人

小規模勢力の場合は King と Nobles のみになります.

fierf score は領地の数に基づいて計算されます. 都市3ポイント, 城1ポイントで評価します. タイの場合は名声で順位を決めます.「いずれかの勢力に所属」なので, 傭兵や反乱軍には爵位が付きません. 臣従するか建国する必要があります.

そんなに大量に称号はいらんという人はすべて同じ名称にすれば問題ありません. ただし既存の称号の表示だけを求めている場合は [Always Show Titles](https://www.nexusmods.com/mountandblade2bannerlord/mods/5178) のほうがおすすめです.

# デフォルト名称について

本家のデフォルト名称がバニラのと食い違う (Khan が Khagan になり Khan が臣下の称号になっている, バニラと同じ名称のランクが各国がバラバラ) ためわかりにくいと感じたので仕様変更に伴いこちらも私なりに変えました. 称号の最下位をバニラの名称に揃え, 上位の名称は覚えやすさを重視して決めました. 称号一覧は画像を見てください.

中世盛期くらいの歴史上の用語を参考にしていますが, カルラディアは歴史上存在しないので当然「史実」ではありません.

* 帝国 - 11-12世紀くらいのビザンツ帝国の官爵位を参考にしています
* アセライ - アラビア語にはあんまり語彙がないのでアミールなんとかで適当に決めました
* クーザイト - 少し時代が古いですが記録が多く残ってる突厥帝国を主に参考にしました. 他の時代はペルシャ由来の語彙が多くアセライとかぶりがちなので避けています
* バッタニア - 主にアイルランド風ですが, バニラはスコットランドの語彙が混じってるので下位の名称はスコットランド風です
* ヴランディア - 多少古い表現のある英語です
* スタルジア - 下位はスラヴ語, 上位はスカンディナヴィア風の語彙です
* (Huaxia) - 唐代の爵位風です. デフォルトの「郡王」はその上に皇帝と皇太子しかいない最上位の爵位なのでここだけ最上位にしています.

# バグ報告について

まず "マイドキュメント\Mount and Blade II Bannerlord\Logs" にあるログファイルを確認してください. titles.jsonの書き間違えならここを見れば気づく可能性が高いです. (ただしv.1.0.0時点ではここのメッセージのほとんどが英語のままです.)

上記を確認しても原因がわからず, クラッシュが相変わらず発生する場合は, 最低限必要なmod以外を全て無効にした上で再度起動してみてください. それでも同じクラッシュが発生する場合は, 必ず Better Exception Window に表示されているエラーレポートを提出してください. それ未満の情報しかない不具合報告にはおそらく対処できません.

その上で, modと併用している時に不具合が発生する場合に, どのmodとの競合かをある程度特定できたならば, その状態でのエラーレポートを提出することも歓迎します. ただし, 一般に他の全てのmodとの互換性を保証するのは難しいため, 必ずしも問題を解決できるとは限りません.

もし故意に偽ったエラーレポートを提出する等の行為が繰り返される場合はそれ相応の対処をします.

# 技術的補足

元のプログラムがNPCの名称を一時的とはいえ直接書き換える形で実装されており, なんかのエラーのひょうしに変な名前になったまま戻らない危険の大きいものだったので, 内部処理を根本的に変更しています. キャンペーン中にインストールアンインストールを繰り返してもセーブデータを壊すことはないと思います. プレイ中に表示がおかしくなってもゲームを再起動すればだいたい直ると思います. 例えばプレイ中に表示言語を変更するとたいていの場合はぐちゃぐちゃになります.

# 昔のドキュメント (v1.x)

以下は v1.x 台の古いバージョン向けのドキュメントです.

## インストール方法

1. 通常通りダウンロードしてモジュールフォルダに配置してください
2. そのままでは称号が英語用なので, Optional Files から追加ファイルをダウンロードし, 中にある titles.json を上記モジュールフォルダ内にある同名のファイルに上書きしてください
3. ランチャーで有効にしてから起動してください

更新する際は titles.json 以外のファイルを一旦消してから新しいファイルを移動してください.

## カスタマイズ

本家は接頭語で固定, かつスペースも固定だったので語順も区切りも任意で変えられるようにしました. 名前は {name} で与えられます. また, {clan} でクラン名を与える事もできます. 例えば "{CLAN}{NAME}" にすると名前がアジア風の「姓名」順の表記になります. Huaxia Kingdom と併用するといいでしょう

## (新機能) 戦場の霧

本体 v1.1.0 以降追加された戦場の霧に対応するように, 称号も会うまで表示されないようにしました. 常に表示したい場合は settings.json で設定を変更できます.

## 他勢力の独自称号

バニラにはない, modで追加された国家 (例: Huaxia, Anorit, Tetsojin ~~(最新版には対応してませんが)~~ といったmodで追加されるもの) にも独自に対応できます.

バニラの勢力以外での称号は通常 default で設定したものが適用されますが, 名前を指定すれば新勢力ごとに設定できます. 国家を定義している XML の Culture タグの id 属性を正確に入力すれば適用されます. 例えば Huaxia Kingdom なら "huaxia" になります. なお Huaxia に関しては日本語版ファイルには私の考えた称号を既に設定しています. (唐代の貴族階級を参考にしています)
